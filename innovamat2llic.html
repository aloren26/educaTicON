<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mètode Innovamat Pas a Pas</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Fira+Code:wght@500&display=swap');
        
        body { 
            font-family: 'Nunito', sans-serif; 
            background-color: #F0F9FF; 
            color: #1e3a8a; 
            margin: 0; 
            height: 100dvh; 
            overflow: hidden; 
        }
        
        #root { height: 100%; display: flex; flex-direction: column; }

        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .slide-up { animation: slideUp 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        .interactive-input:focus { 
            transform: scale(1.05); 
            border-color: #2563EB; 
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2); 
        }
        
        .custom-scroll { overflow-y: auto; }
        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; border: 2px solid #f1f1f1; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Estils Blocs */
        .block-hundred { width: 40px; height: 40px; background-color: #EF4444; border: 1px solid #B91C1C; border-radius: 3px; }
        .block-ten { width: 10px; height: 50px; background-color: #3B82F6; border: 1px solid #1D4ED8; border-radius: 2px; transition: transform 0.2s; }
        .block-ten.clickable { cursor: pointer; }
        .block-ten.clickable:hover { transform: scale(1.1); filter: brightness(1.1); }
        .block-unit { width: 10px; height: 10px; background-color: #4ADE80; border: 1px solid #15803D; border-radius: 2px; }
        
        .crossed-out { position: relative; opacity: 0.6; }
        .crossed-out::after {
            content: '';
            position: absolute;
            top: 50%; left: -10%; right: -10%;
            height: 2px;
            background: #DC2626;
            transform: rotate(-45deg);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONES ---
        const IconHome = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>;
        const IconRefresh = ({size=16}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>;
        const IconCheck = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>;
        const IconInfo = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>;
        const IconArrowRight = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>;
        const IconZoomIn = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>;
        const IconZoomOut = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>;
        const IconGroup = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>;

        // --- COMPONENTS BASE ---
        const Button = ({ onClick, disabled, children, variant = 'primary', className = '' }) => {
            const base = "px-3 py-2 rounded-xl font-bold transition-all shadow-sm flex items-center justify-center gap-2 select-none active:scale-95 text-xs md:text-sm";
            const variants = {
                primary: "bg-blue-600 text-white hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed",
                outline: "bg-white text-blue-600 border-2 border-blue-100 hover:bg-blue-50 hover:border-blue-200",
                success: "bg-green-500 text-white hover:bg-green-600 shadow-green-200",
                zoom: "bg-white text-gray-700 border border-gray-300 hover:bg-gray-100 px-2 py-0.5 rounded shadow-sm text-[10px] uppercase font-bold"
            };
            return <button onClick={onClick} disabled={disabled} className={`${base} ${variants[variant]} ${className}`}>{children}</button>;
        };

        const TopBar = ({ title, onHome, setView }) => (
            <div className="bg-white p-2 shadow-sm border-b border-blue-100 sticky top-0 z-50 flex items-center justify-between relative h-14 shrink-0">
                <div className="flex-1 flex justify-start min-w-0 hidden lg:flex">
                    <h2 className="text-lg font-extrabold text-blue-900 truncate pr-2">{title}</h2>
                </div>
                <div className="absolute left-1/2 transform -translate-x-1/2 z-10 flex items-center gap-1 w-full md:w-auto justify-center px-1">
                    <Button onClick={() => setView('suma')} className="!py-1 !px-2 text-[10px] bg-green-50 text-green-700 border border-green-200 hover:bg-green-100">SUMA</Button>
                    <Button onClick={() => setView('resta')} className="!py-1 !px-2 text-[10px] bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100">RESTA</Button>
                    <Button variant="outline" onClick={onHome} className="!py-1 !px-6 shadow-md border-blue-200 text-blue-700 bg-white hover:bg-blue-50 mx-1 text-[10px]"><IconHome /> <span className="font-bold">INICI</span></Button>
                    <Button onClick={() => setView('multi')} className="!py-1 !px-2 text-[10px] bg-yellow-50 text-yellow-700 border border-yellow-200 hover:bg-yellow-100">MULTIPLICACIÓ</Button>
                    <Button onClick={() => setView('divi')} className="!py-1 !px-2 text-[10px] bg-purple-50 text-purple-700 border border-purple-200 hover:bg-purple-100">DIVISIÓ</Button>
                </div>
                <div className="flex-1 flex justify-end hidden lg:flex">
                    <span className="text-xs font-bold text-gray-500 text-right leading-tight max-w-[120px] md:max-w-none">El Mètode Innovamat Pas a Pas</span>
                </div>
            </div>
        );

        const ExplanationPanel = ({ title, content, levelSelector }) => (
            <div className="bg-white p-4 rounded-2xl shadow-lg border-l-4 border-blue-500 w-full lg:w-2/5 flex flex-col gap-3 overflow-hidden h-fit max-h-[35vh] lg:max-h-full lg:h-auto shrink-0">
                <div className="flex items-center gap-2 text-blue-600 mb-0 shrink-0">
                    <IconInfo />
                    <h3 className="font-bold uppercase tracking-wider text-xs">Explicació</h3>
                </div>
                <h4 className="text-lg font-bold text-gray-800 shrink-0 leading-tight">{title}</h4>
                <div className="text-gray-600 text-sm leading-snug space-y-2 flex-1 overflow-y-auto pr-2 custom-scroll">
                    {content}
                </div>
                {levelSelector && (
                    <div className="mt-auto pt-3 border-t border-gray-100 shrink-0">
                        <p className="text-[10px] font-bold text-gray-400 uppercase mb-2">Canviar Tipus d'Exercici</p>
                        {levelSelector}
                        <div className="mt-2 flex items-center gap-2 text-[10px] text-gray-400 italic bg-gray-50 p-1.5 rounded border border-gray-100">
                            <IconRefresh size={12} />
                            <span>Clica els botons per generar operacions noves aleatòries.</span>
                        </div>
                    </div>
                )}
            </div>
        );

        const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        // --- 1. SUMA ---
        const SumaView = ({ onBack, setView }) => {
            const [mode, setMode] = useState('simple'); 
            const [data, setData] = useState(null);
            const [phase, setPhase] = useState(0); 
            const [inputs, setInputs] = useState({ pUnits: "", pTens: "", pHundreds: "", total: "" });
            const [msg, setMsg] = useState("");

            const generateData = (selectedMode) => {
                const isHundred = Math.random() < 0.166;
                let n1, n2;
                
                if (selectedMode === 'simple') {
                    // SENSE PORTAR: Assegurar que la suma d'unitats < 10
                    if (isHundred) {
                        n1 = randomInt(100, 400);
                        const u1 = n1 % 10;
                        const d1 = Math.floor(n1 / 10) % 10;
                        
                        const maxU2 = 9 - u1;
                        const u2 = randomInt(1, maxU2); 
                        const maxD2 = 9 - d1;
                        const d2 = randomInt(1, 9 - d1); 
                        const h2 = randomInt(1, 4); 
                        n2 = h2 * 100 + d2 * 10 + u2;
                    } else {
                        do { n1 = randomInt(12, 60); } while (n1 % 10 === 9); 
                        const u1 = n1 % 10;
                        
                        // Generem n2 de 2 xifres sense portar
                        const maxU2 = 9 - u1; 
                        const u2 = randomInt(1, maxU2); 
                        
                        // Perquè n2 tingui 2 xifres, d2 ha de ser almenys 1
                        // Assegurem que d1+d2 tampoc porti si volem (opcional), però el crític és unitats.
                        // Fem que d2 sigui entre 1 i 3 per no complicar.
                        const d2 = randomInt(1, 3);
                        n2 = d2 * 10 + u2;
                    }
                } else {
                    // PORTANT-NE: Assegurar que u1 + u2 >= 10 i NO siguin rodons
                    if (isHundred) {
                        n1 = randomInt(120, 380);
                        let u1 = n1 % 10;
                        if(u1===0) n1+=1;
                        const minU2 = 10 - (n1%10);
                        const u2 = randomInt(minU2, 9);
                        const d2 = randomInt(1, 4);
                        const h2 = randomInt(1, 2);
                        n2 = h2 * 100 + d2 * 10 + u2;
                    } else {
                        // 2 xifres
                        do { n1 = randomInt(15, 58); } while (n1%10 === 0);
                        const u1 = n1 % 10;
                        
                        const minU2 = 10 - u1;
                        const u2 = randomInt(minU2, 9);
                        const d2 = randomInt(1, 3);
                        n2 = d2 * 10 + u2;
                    }
                }
                const n1h = Math.floor(n1/100);
                const n1t = Math.floor((n1%100)/10);
                const n1u = n1%10;
                const n2h = Math.floor(n2/100);
                const n2t = Math.floor((n2%100)/10);
                const n2u = n2%10;
                const sumU = n1u + n2u;
                const sumT = (n1t + n2t) * 10;
                const sumH = (n1h + n2h) * 100;
                return { n1, n2, n1h, n1t, n1u, n2h, n2t, n2u, sumU, sumT, sumH, total: n1+n2, carry: selectedMode === 'carry', hasHundreds: n1 >= 100 || n2 >= 100 };
            };

            useEffect(() => { loadLevel('simple'); }, []);

            const loadLevel = (m) => {
                setMode(m);
                setData(generateData(m));
                setPhase(0);
                setInputs({ pUnits: "", pTens: "", pHundreds: "", total: "" });
                setMsg("Suma les unitats i escriu el resultat complet.");
            };

            const handleGroup = () => {
                if(phase === 0 && data.carry) {
                    setPhase(1);
                    setMsg("Molt bé! Hem convertit 10 unitats en 1 desena.");
                }
            };

            const check = () => {
                if (!data) return;
                
                if (data.carry && phase === 0) {
                     setMsg("Tens més de 10 unitats! Agrupa-les clicant el botó groc.");
                     return;
                }

                if (inputs.pUnits === "" || parseInt(inputs.pUnits) !== data.sumU) {
                     setMsg("Revisa la suma de les unitats.");
                     return;
                }

                const targetPhaseTens = data.carry ? 2 : 1; 
                if (phase >= targetPhaseTens && (inputs.pTens === "" || parseInt(inputs.pTens) !== data.sumT)) {
                     setMsg("Ara suma les desenes.");
                     return;
                }
                
                if (data.hasHundreds) {
                     const targetPhaseH = targetPhaseTens + 1;
                     if (phase >= targetPhaseH && (inputs.pHundreds === "" || parseInt(inputs.pHundreds) !== data.sumH)) {
                         setMsg("Ara suma les centenes.");
                         return;
                     }
                }

                if (phase === 0 && !data.carry) { setPhase(1); setMsg("Molt bé. Ara suma les desenes."); }
                else if (phase === 1 && data.carry) { setPhase(2); setMsg("Bé. Ara suma les desenes."); }
                else if (phase === 1 && !data.carry && data.hasHundreds) { setPhase(2); setMsg("Correcte. Ara les centenes."); }
                else if (phase === 2 && data.carry && data.hasHundreds) { setPhase(3); setMsg("Perfecte. Ara les centenes."); }
                else {
                    if (inputs.total === "" || parseInt(inputs.total) !== data.total) {
                         const finalP = data.hasHundreds ? (data.carry?4:3) : (data.carry?3:2);
                         setPhase(finalP);
                         setMsg("Ara suma tots els resultats parcials per trobar el total.");
                    } else {
                         setPhase(99); 
                         setMsg("Fantàstic!");
                    }
                }
            };

            if(!data) return null;

            return (
                <div className="flex flex-col h-full overflow-hidden">
                    <TopBar title="Taller de Sumes" onHome={onBack} setView={setView} />
                    <div className="flex flex-col lg:flex-row flex-1 p-2 md:p-4 gap-4 h-full overflow-hidden pb-12">
                         
                         <ExplanationPanel 
                            title={mode === 'simple' ? "Suma sense portar" : "Suma portant-ne"}
                            content={
                                <div>
                                    <p className="mb-2">Sumem per parts (descomposició):</p>
                                    <ul className="list-disc pl-4 mt-2 space-y-2 text-sm">
                                        <li>Sumem les <strong>unitats</strong> (verds).</li>
                                        <li>Sumem les <strong>desenes</strong> (blaus).</li>
                                        {data.hasHundreds && <li>Sumem les <strong>centenes</strong> (vermells).</li>}
                                        <li>Sumem tots els resultats parcials.</li>
                                    </ul>
                                </div>
                            }
                            levelSelector={
                                <div className="grid grid-cols-2 gap-2">
                                    <Button onClick={() => loadLevel('simple')} variant={mode === 'simple' ? 'primary' : 'outline'}>Sense portar</Button>
                                    <Button onClick={() => loadLevel('carry')} variant={mode === 'carry' ? 'primary' : 'outline'}>Portant-ne</Button>
                                </div>
                            }
                        />

                        <div className="bg-white rounded-3xl shadow-xl border border-gray-100 w-full lg:w-3/5 p-4 flex flex-col items-center justify-center relative overflow-y-auto custom-scroll">
                            
                            <div className="flex flex-col md:flex-row gap-6 items-start w-full max-w-3xl justify-center mb-6">
                                {/* BLOCS VISUALS */}
                                <div className="flex flex-col gap-2 p-3 bg-gray-50 rounded-xl border border-gray-100 min-w-[120px] items-center">
                                    <span className="text-[10px] font-bold text-gray-400">MATERIAL</span>
                                    {/* Num 1 */}
                                    <div className="flex gap-2 items-end justify-end w-full">
                                        <div className="flex gap-1">{Array.from({length: data.n1h}).map((_,i)=><div key={i} className="block-hundred"></div>)}</div>
                                        <div className="flex gap-1">{Array.from({length: data.n1t}).map((_,i)=><div key={i} className="block-ten"></div>)}</div>
                                        <div className="grid grid-cols-2 gap-0.5 w-8 content-end">{Array.from({length: data.n1u}).map((_,i)=><div key={i} className="block-unit"></div>)}</div>
                                    </div>
                                    <div className="w-full h-px bg-gray-300"></div>
                                    {/* Num 2 */}
                                    <div className="flex gap-2 items-end justify-end w-full">
                                        <div className="flex gap-1">{Array.from({length: data.n2h}).map((_,i)=><div key={i} className="block-hundred"></div>)}</div>
                                        <div className="flex gap-1">{Array.from({length: data.n2t}).map((_,i)=><div key={i} className="block-ten"></div>)}</div>
                                        <div className="grid grid-cols-2 gap-0.5 w-8 content-end">{Array.from({length: data.n2u}).map((_,i)=><div key={i} className="block-unit"></div>)}</div>
                                    </div>
                                    {phase >= 1 && data.carry && (
                                        <div className="absolute top-1/2 left-4 text-[10px] font-bold text-yellow-600 bg-yellow-100 px-2 rounded animate-pulse">Agrupat!</div>
                                    )}
                                </div>

                                {/* ALGORITME */}
                                <div className="flex flex-col items-end text-4xl font-mono text-gray-800">
                                    <div className="text-right tracking-widest">{data.n1}</div>
                                    <div className="text-right tracking-widest flex items-center">
                                        <span className="mr-2 text-2xl text-gray-400">+</span> {data.n2}
                                    </div>
                                    <div className="w-full border-b-4 border-gray-800 my-1"></div>
                                    
                                    <div className="flex flex-col items-end gap-1 w-full">
                                        {/* Unitats */}
                                        <div className="flex items-center gap-2">
                                            {phase===0 && <span className="text-xs text-green-600 font-sans">Unitats</span>}
                                            <input type="number" className="w-24 text-right border-2 border-green-200 rounded bg-green-50 text-green-900 p-1 font-bold text-2xl" 
                                            value={inputs.pUnits} onChange={e=>setInputs({...inputs, pUnits:e.target.value})} disabled={phase>0 && !data.carry || phase>1} />
                                        </div>
                                        {/* Desenes */}
                                        <div className="flex items-center gap-2">
                                            {(phase===1 || (data.carry && phase===2)) && <span className="text-xs text-blue-600 font-sans">Desenes</span>}
                                            <input type="number" className="w-24 text-right border-2 border-blue-200 rounded bg-blue-50 text-blue-900 p-1 font-bold text-2xl" 
                                            value={inputs.pTens} onChange={e=>setInputs({...inputs, pTens:e.target.value})} disabled={!((!data.carry && phase===1) || (data.carry && phase===2))} />
                                        </div>
                                        {/* Centenes (si n'hi ha) */}
                                        {data.hasHundreds && (
                                            <div className="flex items-center gap-2">
                                                {((!data.carry && phase===2) || (data.carry && phase===3)) && <span className="text-xs text-red-600 font-sans">Centenes</span>}
                                                <input type="number" className="w-24 text-right border-2 border-red-200 rounded bg-red-50 text-red-900 p-1 font-bold text-2xl" 
                                                value={inputs.pHundreds} onChange={e=>setInputs({...inputs, pHundreds:e.target.value})} disabled={!((!data.carry && phase===2) || (data.carry && phase===3))} />
                                            </div>
                                        )}
                                    </div>

                                    <div className="w-full border-b-4 border-gray-800 my-1"></div>
                                    <div className="flex items-center gap-2 w-full justify-end">
                                        <span className="text-xs text-gray-400 font-sans font-bold uppercase tracking-wider text-[10px]">Total</span>
                                        <input type="number" className="w-24 text-right border-2 border-gray-400 rounded bg-gray-100 text-gray-900 p-1 font-bold text-3xl" 
                                        value={inputs.total} onChange={e=>setInputs({...inputs, total:e.target.value})} 
                                        disabled={phase === 99 || phase < (data.hasHundreds ? (data.carry?4:3) : (data.carry?3:2))} />
                                    </div>
                                </div>
                            </div>

                            <div className="w-full max-w-md text-center flex flex-col gap-2">
                                <div className="min-h-[40px] flex items-center justify-center">
                                    <span className="text-sm font-bold text-blue-800 bg-blue-50 px-3 py-1 rounded-full border border-blue-100">{msg}</span>
                                </div>
                                {data.carry && phase === 0 ? (
                                    <Button onClick={handleGroup} className="w-full py-3 bg-yellow-500 hover:bg-yellow-600 text-white shadow-yellow-200 animate-pulse">
                                        <IconGroup /> Agrupar 10 unitats!
                                    </Button>
                                ) : (
                                    phase !== 99 ? (
                                        <Button onClick={check} className="w-full py-3">Comprovar</Button>
                                    ) : (
                                        <Button onClick={()=>loadLevel(mode)} variant="success" className="w-full py-3">Següent Suma <IconRefresh/></Button>
                                    )
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 2. RESTA ---
        const RestaView = ({ onBack, setView }) => {
            const [data, setData] = useState(null);
            const [phase, setPhase] = useState(0); 
            const [inputs, setInputs] = useState({ tens:"", units:"", rt:"", ru:"" });
            const [msg, setMsg] = useState("");
            const [mode, setMode] = useState("direct");

            const generateData = (selectedMode) => {
                const isHundred = Math.random() < 0.166;
                let m, s;
                
                if (selectedMode === 'direct') {
                    if (isHundred) {
                        m = randomInt(120, 490);
                        const mu = m % 10;
                        const su = randomInt(0, mu);
                        const mt = Math.floor(m/10)%10;
                        const st = randomInt(0, mt);
                        const mh = Math.floor(m/100);
                        const sh = randomInt(0, mh-1);
                        s = sh*100 + st*10 + su;
                    } else {
                        do { m = randomInt(25, 99); s = randomInt(11, m - 10); } while ((m % 10) < (s % 10));
                    }
                } else {
                    if (isHundred) {
                        m = randomInt(120, 480);
                        const mu = m % 10;
                        const su = randomInt(mu + 1, 9);
                        const mt = Math.floor(m/10)%10;
                        if(mt === 0) m += 10; 
                        const st = randomInt(0, Math.floor(m/10)%10 - 1);
                        const sh = randomInt(0, Math.floor(m/100)-1);
                        s = sh*100 + st*10 + su;
                    } else {
                        do { m = randomInt(32, 95); s = randomInt(15, m - 5); } while ((m % 10) >= (s % 10)); 
                    }
                }
                
                const mt = Math.floor(m/10)%10;
                const mu = m%10;
                const mh = Math.floor(m/100);
                const st = Math.floor(s/10)%10;
                const su = s%10;
                const sh = Math.floor(s/100);
                
                return { m, s, mh, mt, mu, sh, st, su, broken: selectedMode === 'break', isBroken: false, hasHundreds: m >= 100 };
            };

            const loadLevel = (m) => {
                setMode(m);
                setData(generateData(m));
                setPhase(0); setInputs({ u:"", t:"", h:"" }); 
                setMsg(m === 'break' ? "Pots restar les unitats? Si no, trenquem una desena." : "Resta les unitats.");
            };

            useEffect(() => { loadLevel('direct'); }, []);
            
            const breakTen = () => {
                if (data.broken && !data.isBroken) {
                    setData({...data, isBroken: true});
                    setMsg("Desena trencada! Ara ja tens prou unitats.");
                }
            };

            const check = () => {
                if (!data) return;
                
                if (data.broken && !data.isBroken) {
                    setMsg("No tens prou unitats. Clica una barra blava per trencar-la!");
                    return;
                }

                const effMu = data.isBroken ? data.mu + 10 : data.mu;
                const effMt = data.isBroken ? data.mt - 1 : data.mt; 
                
                const resU = effMu - data.su;
                const resT = effMt - data.st;
                const resH = data.mh - data.sh;

                if (phase === 0) {
                    if (parseInt(inputs.u) === resU) {
                        setPhase(1); setMsg("Unitats fetes. Ara les desenes.");
                    } else setMsg("Revisa les unitats.");
                } else if (phase === 1) {
                    if (parseInt(inputs.t) === resT) {
                         if (data.hasHundreds) {
                             setPhase(2); setMsg("Desenes fetes. Ara les centenes.");
                         } else {
                             setPhase(3); setMsg("Molt bé!");
                         }
                    } else setMsg("Revisa les desenes.");
                } else if (phase === 2) {
                    if (parseInt(inputs.h) === resH) {
                        setPhase(3); setMsg("Perfecte!");
                    } else setMsg("Revisa les centenes.");
                }
            };

            if(!data) return null;

            return (
                <div className="flex flex-col h-full overflow-hidden">
                    <TopBar title="Taller de Restes" onHome={onBack} setView={setView} />
                    <div className="flex flex-col lg:flex-row flex-1 p-4 gap-4 overflow-hidden pb-12">
                        <ExplanationPanel 
                            title={mode === 'direct' ? "Resta sense portar" : "Resta portant-ne"}
                            content={mode === 'direct' ? 
                                <p>Tenim prou unitats al número de dalt. Restem columna per columna.</p> : 
                                <>
                                    <p>Volem restar més unitats de les que tenim.</p>
                                    <p className="mt-2 font-bold text-blue-600">Solució: Trencar una desena.</p>
                                    <p>Clica una de les barres blaves per <strong>trencar-la</strong> i convertir-la en 10 unitats.</p>
                                </>
                            }
                            levelSelector={
                                <div className="grid grid-cols-2 gap-2">
                                    <Button onClick={() => loadLevel('direct')} variant={mode === 'direct' ? 'primary' : 'outline'}>Sense portar</Button>
                                    <Button onClick={() => loadLevel('break')} variant={mode === 'break' ? 'primary' : 'outline'}>Portant-ne</Button>
                                </div>
                            }
                        />
                        <div className="bg-white rounded-2xl shadow-xl border border-blue-50 w-full lg:w-3/5 p-4 flex flex-col items-center justify-center relative overflow-y-auto custom-scroll">
                             
                             <div className="flex flex-row gap-8 items-start w-full max-w-lg justify-center mb-6">
                                {/* BLOCS INTERACTIUS */}
                                <div className="flex flex-col gap-3 p-4 bg-gray-50 rounded-xl border border-gray-100 min-w-[140px] items-center relative">
                                    <span className="text-[10px] font-bold text-gray-400 absolute top-1 left-2">MINUEND</span>
                                    
                                    <div className="flex gap-2 items-end mt-4">
                                        {/* Centenes */}
                                        <div className="flex gap-1">
                                            {Array.from({length: data.mh}).map((_,i)=><div key={i} className="block-hundred"></div>)}
                                        </div>
                                        {/* Desenes */}
                                        <div className="flex gap-1">
                                            {Array.from({length: data.isBroken ? data.mt - 1 : data.mt}).map((_,i) => {
                                                if (data.isBroken && i === data.mt - 1) return null; 
                                                return (
                                                    <div key={i} 
                                                        className={`block-ten ${data.broken && !data.isBroken && i === data.mt - 1 ? 'animate-pulse cursor-pointer hover:bg-blue-400 border-dashed border-white clickable' : ''}`}
                                                        onClick={() => { if(data.broken && !data.isBroken && i === data.mt - 1) breakTen(); }}
                                                    >
                                                        {data.broken && !data.isBroken && i === data.mt - 1 && <span className="flex items-center justify-center h-full text-white text-[8px] -rotate-90 font-bold">CLICK</span>}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                        {/* Unitats */}
                                        <div className="grid grid-cols-5 gap-0.5 w-[60px] content-end">
                                            {Array.from({length: data.mu}).map((_,i)=><div key={`u-${i}`} className="block-unit"></div>)}
                                            {data.isBroken && Array.from({length: 10}).map((_,i)=><div key={`new-${i}`} className="block-unit bg-green-300 border-green-400 bounce-in"></div>)}
                                        </div>
                                    </div>
                                    
                                    <div className="mt-2 text-xs text-red-400 font-bold border-t border-gray-300 pt-1 w-full text-center">
                                        Treure: {data.s}
                                    </div>
                                </div>

                                {/* ALGORITME */}
                                <div className="flex flex-col items-end text-5xl font-mono text-gray-800">
                                    {/* Inputs de descomposició (a dalt) */}
                                    <div className="flex gap-4 mb-2 h-16 items-end">
                                         {data.isBroken && (
                                            <>
                                                <span className="text-sm font-sans font-bold text-blue-400">Ara tenim:</span>
                                                <div className="text-3xl text-blue-600 font-bold animate-in slide-up">{data.mt - 1}</div>
                                                <div className="text-3xl text-green-600 font-bold animate-in slide-up">{data.mu + 10}</div>
                                            </>
                                         )}
                                    </div>

                                    {/* Nombres base (ratllats si cal) */}
                                    <div className="flex flex-col items-end relative">
                                        <div className={`text-right tracking-widest relative ${data.isBroken ? 'text-gray-300 crossed-out' : ''}`}>
                                            {data.m}
                                        </div>
                                        <div className="text-right tracking-widest flex items-center relative">
                                            <span className="absolute left-[-30px] text-4xl text-gray-300">-</span> 
                                            {data.s}
                                        </div>
                                    </div>
                                    
                                    {/* Resultats */}
                                    <div className="flex justify-end gap-2 w-full mt-4 border-t-4 border-gray-800 pt-2">
                                        {data.hasHundreds && (
                                            <input type="number" className="w-16 text-center border-b-2 border-red-300 bg-transparent text-red-900 p-1 font-bold text-4xl outline-none" 
                                            value={inputs.h} onChange={e=>setInputs({...inputs, h:e.target.value})} disabled={phase<2} placeholder="C" />
                                        )}
                                        <input type="number" className="w-16 text-center border-b-2 border-blue-300 bg-transparent text-blue-900 p-1 font-bold text-4xl outline-none" 
                                        value={inputs.t} onChange={e=>setInputs({...inputs, t:e.target.value})} disabled={phase<1} placeholder="D" />
                                        
                                        <input type="number" className="w-16 text-center border-b-2 border-green-300 bg-transparent text-green-900 p-1 font-bold text-4xl outline-none" 
                                        value={inputs.u} onChange={e=>setInputs({...inputs, u:e.target.value})} disabled={phase>0 && !data.hasHundreds && phase!==0} autoFocus placeholder="U" />
                                    </div>
                                </div>
                            </div>

                            <div className="mt-4 w-full max-w-md text-center pb-4">
                                <div className="h-10 mb-2 flex items-center justify-center">
                                    <span className="text-sm font-bold text-blue-800 bg-blue-50 px-3 py-1 rounded-full border border-blue-100">{msg}</span>
                                </div>
                                {phase < 3 ? <Button onClick={check} className="w-full py-3">Comprovar</Button> : <Button onClick={()=>loadLevel(mode)} variant="success" className="w-full py-3">Següent Resta <IconRefresh/></Button>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 3. MULTIPLICACIÓ ---
        const MultiView = ({ onBack, setView }) => {
            const [data, setData] = useState(null);
            const [phase, setPhase] = useState(0);
            const [vals, setVals] = useState({});
            const [msg, setMsg] = useState("");
            const [mode, setMode] = useState("simple");

            const generateData = (m) => {
                if (m === 'simple') {
                    const f1 = randomInt(2, 9);
                    const f2 = randomInt(20, 59);
                    const tens = Math.floor(f2/10)*10;
                    const units = f2%10;
                    return { f1, f2, tens, units, complex: false };
                } else {
                    const f1 = randomInt(11, 19);
                    const f2 = randomInt(11, 19);
                    return { f1, f2, complex: true };
                }
            };

            const loadLevel = (m) => {
                setMode(m);
                setData(generateData(m));
                setPhase(0); setVals({}); setMsg("");
            };

            useEffect(() => { if (!data) loadLevel('simple'); }, []);
            if (!data) return null;

            const check = () => {
                if (!data.complex) {
                    const p1 = data.tens * data.f1; 
                    const p2 = data.units * data.f1; 
                    if (phase === 0) {
                        if (parseInt(vals.a) === p1 && parseInt(vals.b) === p2) { setPhase(1); setMsg("Bé! Ara suma les dues àrees."); }
                        else setMsg(`Revisa: ${data.tens} x ${data.f1} i ${data.units} x ${data.f1}`);
                    } else {
                        if (parseInt(vals.total) === data.f1 * data.f2) { setPhase(2); setMsg("Correcte!"); }
                        else setMsg("Error en la suma.");
                    }
                } else {
                    const [d1, u1] = [10, data.f1 % 10];
                    const [d2, u2] = [10, data.f2 % 10];
                    if (phase === 0) {
                        if (parseInt(vals.a) === d1*d2 && parseInt(vals.b) === d1*u2 && parseInt(vals.c) === u1*d2 && parseInt(vals.d) === u1*u2) {
                            setPhase(1); setMsg("Perfecte! Ara suma les 4 parts.");
                        } else setMsg("Calcula l'àrea de cada rectangle.");
                    } else {
                        if (parseInt(vals.total) === data.f1 * data.f2) { setPhase(2); setMsg("Fantàstic!"); }
                        else setMsg("Error en la suma.");
                    }
                }
            };

            return (
                <div className="flex flex-col h-full overflow-hidden">
                    <TopBar title="Taller de Multiplicacions" onHome={onBack} setView={setView} />
                    <div className="flex flex-col lg:flex-row flex-1 p-4 gap-6 overflow-hidden pb-16">
                        <ExplanationPanel 
                            title={mode === 'simple' ? "Model d'Àrea (1 x 2 xifres)" : "Model d'Àrea (2 x 2 xifres)"}
                            content={
                                <div>
                                    <p>Multiplicar és calcular l'àrea d'un rectangle.</p>
                                    <p className="mt-2">Si els números són difícils (com 42 x 6), partim el número gran en <strong>desenes + unitats</strong>.</p>
                                    <p className="mt-2">Exemple: 42 es converteix en 40 i 2. Així fem 40x6 i 2x6, que és molt més fàcil!</p>
                                </div>
                            }
                            levelSelector={
                                <div className="grid grid-cols-2 gap-2">
                                    <Button onClick={() => loadLevel('simple')} variant={mode === 'simple' ? 'primary' : 'outline'}>1 xifra</Button>
                                    <Button onClick={() => loadLevel('complex')} variant={mode === 'complex' ? 'primary' : 'outline'}>2 xifres</Button>
                                </div>
                            }
                        />
                        <div className="bg-white rounded-2xl shadow-xl border border-blue-50 w-full lg:w-2/3 p-8 flex flex-col items-center justify-center overflow-y-auto custom-scroll">
                            {!data.complex ? (
                                <div className="flex flex-col items-center animate-in slide-up pt-4">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-6">{data.f1} x {data.f2}</h2>
                                    <div className="flex w-full mb-2 font-bold text-gray-400 text-xl pl-8">
                                        <div className="flex-1 text-center border-b-2 border-gray-200 pb-2">{data.tens}</div>
                                        <div className="w-32 text-center border-b-2 border-gray-200 pb-2">{data.units}</div>
                                    </div>
                                    <div className="flex">
                                        <div className="flex flex-col justify-center pr-4 font-bold text-2xl text-gray-400 border-r-2 border-gray-200">{data.f1}</div>
                                        <div className="flex shadow-lg rounded-lg overflow-hidden border-2 border-white">
                                            <div className="w-48 h-32 bg-blue-100 flex items-center justify-center border-r border-white relative">
                                                <span className="absolute text-4xl text-blue-200 font-bold opacity-60 z-0">{data.tens}x{data.f1}</span>
                                                <input type="number" className="z-10 w-24 p-2 text-center font-bold text-2xl rounded shadow bg-white/90 outline-none focus:ring-2 focus:ring-blue-400" value={vals.a} onChange={e=>setVals({...vals, a:e.target.value})} placeholder="?" disabled={phase>0}/>
                                            </div>
                                            <div className="w-24 h-32 bg-red-100 flex items-center justify-center relative">
                                                <span className="absolute text-3xl text-red-200 font-bold opacity-60 z-0">{data.units}x{data.f1}</span>
                                                <input type="number" className="z-10 w-16 p-2 text-center font-bold text-2xl rounded shadow bg-white/90 outline-none focus:ring-2 focus:ring-red-400" value={vals.b} onChange={e=>setVals({...vals, b:e.target.value})} placeholder="?" disabled={phase>0}/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="flex flex-col items-center scale-90 md:scale-100 pt-4">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-6">{data.f1} x {data.f2}</h2>
                                    <div className="flex w-full mb-2 font-bold text-gray-400 text-xl pl-12">
                                        <div className="w-32 text-center border-b-2 border-gray-200">10</div>
                                        <div className="w-24 text-center border-b-2 border-gray-200">{data.f2%10}</div>
                                    </div>
                                    <div className="flex">
                                        <div className="flex flex-col justify-between py-6 pr-2 font-bold text-xl text-gray-400 border-r-2 border-gray-200">
                                            <div className="h-24 flex items-center">10</div>
                                            <div className="h-16 flex items-center">{data.f1%10}</div>
                                        </div>
                                        <div className="flex flex-col shadow-xl rounded-lg overflow-hidden border-2 border-white">
                                            <div className="flex">
                                                <div className="w-32 h-24 bg-blue-100 border border-white flex items-center justify-center"><input type="number" className="w-20 p-1 text-center font-bold bg-white/90 rounded outline-none" placeholder="?" value={vals.a} onChange={e=>setVals({...vals, a:e.target.value})} disabled={phase>0}/></div>
                                                <div className="w-24 h-24 bg-blue-50 border border-white flex items-center justify-center"><input type="number" className="w-16 p-1 text-center font-bold bg-white/90 rounded outline-none" placeholder="?" value={vals.b} onChange={e=>setVals({...vals, b:e.target.value})} disabled={phase>0}/></div>
                                            </div>
                                            <div className="flex">
                                                <div className="w-32 h-16 bg-blue-50 border border-white flex items-center justify-center"><input type="number" className="w-20 p-1 text-center font-bold bg-white/90 rounded outline-none" placeholder="?" value={vals.c} onChange={e=>setVals({...vals, c:e.target.value})} disabled={phase>0}/></div>
                                                <div className="w-24 h-16 bg-red-50 border border-white flex items-center justify-center"><input type="number" className="w-16 p-1 text-center font-bold bg-white/90 rounded outline-none" placeholder="?" value={vals.d} onChange={e=>setVals({...vals, d:e.target.value})} disabled={phase>0}/></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="mt-8 w-full max-w-md text-center pb-8">
                                {msg && <div className="p-3 mb-4 bg-blue-50 rounded-xl font-bold text-blue-800 border border-blue-100">{msg}</div>}
                                {phase === 1 && <div className="flex justify-center gap-3 text-2xl font-mono mb-4 items-center animate-in slide-up"><span>Total:</span><input type="number" className="border-2 border-blue-400 w-32 text-center rounded-lg p-1 outline-none focus:ring-2 focus:ring-blue-300" value={vals.total} onChange={e=>setVals({...vals, total:e.target.value})} autoFocus/></div>}
                                {phase < 2 ? <Button onClick={check} className="w-full">Comprovar</Button> : <Button onClick={()=>loadLevel(mode)} variant="success" className="w-full">Següent Multiplicació <IconRefresh/></Button>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 4. DIVISIÓ ---
        const DivisioView = ({ onBack, setView }) => {
            const [data, setData] = useState(null);
            const [history, setHistory] = useState([]);
            const [rem, setRem] = useState(0);
            const [input, setInput] = useState("");
            const [msg, setMsg] = useState("");

            const items = [
                { name: "caramels", target: "amics", singularTarget: "amic" },
                { name: "pilotes", target: "cistelles", singularTarget: "cistella" },
                { name: "cromos", target: "àlbums", singularTarget: "àlbum" },
                { name: "samarretes", target: "equips", singularTarget: "equip" },
                { name: "pomes", target: "caixes", singularTarget: "caixa" },
                { name: "llapis", target: "estoigs", singularTarget: "estoig" },
                { name: "ous", target: "oueres", singularTarget: "ouera" }
            ];

            const loadLevel = () => {
                const d = randomInt(3, 9);
                const q = randomInt(15, 45); 
                const item = items[randomInt(0, items.length - 1)];
                setData({ d, total: d * q, item });
                setRem(d * q);
                setHistory([]);
                setMsg(""); setInput("");
            };

            useEffect(() => { if (!data) loadLevel(); }, []);
            if (!data) return null;

            const handleInput = () => {
                const val = parseInt(input);
                if (!val || val <= 0) return;
                const sub = val * data.d;
                if (sub > rem) { setMsg("Massa gran! No pots repartir el que no tens."); return; }
                const newR = rem - sub;
                setHistory([...history, { mul: val, sub, newR }]);
                setRem(newR);
                setInput("");
                setMsg(newR === 0 ? "Exacte! Ja no queda res." : "Continua repartint el que queda.");
            };

            const totalQ = history.reduce((a, b) => a + b.mul, 0);

            // Determine verb based on item target
            const getVerb = (target) => target === 'amics' ? 'dones' : 'poses';

            return (
                <div className="flex flex-col h-screen">
                    <TopBar title="Divisió en caixa" onHome={onBack} setView={setView} />
                    <div className="flex flex-col lg:flex-row flex-1 p-4 gap-6 overflow-hidden pb-16">
                         <ExplanationPanel 
                            title="Divisió en caixa"
                            content={
                                <div>
                                    <div className="bg-purple-50 p-4 rounded-xl border border-purple-100 my-4 text-purple-900 shadow-sm">
                                        <p className="font-bold text-lg mb-2">Enunciat del problema:</p>
                                        <p className="leading-relaxed">"Tens <strong>{data.total} {data.item.name}</strong> i els has de repartir en <strong>{data.d} {data.item.target}</strong>. Quants {data.item.name} {getVerb(data.item.target)} a cada lloc?"</p>
                                    </div>
                                    <p>No cal endevinar-ho de cop. Vés posant grups petits (10 a cada lloc, 5 a cada lloc...) i mira quants te'n queden.</p>
                                </div>
                            }
                        />

                        <div className="bg-white rounded-2xl shadow-xl border border-blue-50 w-full lg:w-2/3 p-8 flex flex-col items-center overflow-y-auto custom-scroll">
                            <div className="w-full max-w-md font-mono text-2xl pt-4">
                                <div className="flex justify-between border-b-4 border-gray-800 pb-2 mb-4">
                                    <span className="pl-4 font-bold text-4xl text-gray-800">{data.total}</span>
                                    <div className="border-l-4 border-gray-800 pl-6">
                                        <span className="bg-gray-100 px-4 py-1 rounded font-bold text-blue-800">{data.d}</span>
                                    </div>
                                </div>
                                
                                <div className="space-y-2">
                                    {history.map((h, i) => (
                                        <div key={i} className="flex justify-between animate-in slide-up items-center">
                                            <div className="flex flex-col">
                                                <span className="text-red-400 text-lg">- {h.sub}</span>
                                                <span className="border-t-2 border-gray-300 pl-2 font-bold">{h.newR}</span>
                                            </div>
                                            <div className="border-l-2 border-gray-800 pl-6 text-blue-600 font-bold text-3xl">{h.mul}</div>
                                        </div>
                                    ))}
                                    
                                    {rem > 0 && (
                                        <div className="flex justify-between bg-blue-50 p-3 rounded-xl items-center mt-4 border border-blue-200 shadow-sm">
                                            <div className="text-sm text-blue-800 flex-1 pr-2">
                                                Quants en {getVerb(data.item.target)} a cada {data.item.singularTarget}?
                                            </div>
                                            <div className="border-l-2 border-blue-200 pl-4 flex gap-2">
                                                <input 
                                                    type="number" 
                                                    value={input} 
                                                    onChange={e=>setInput(e.target.value)} 
                                                    onKeyDown={e=>e.key==='Enter' && handleInput()}
                                                    className="w-20 text-center font-bold border-2 border-blue-300 rounded p-1 outline-none focus:border-blue-600 bg-white" 
                                                    placeholder="?" 
                                                    autoFocus
                                                />
                                                <Button onClick={handleInput} className="!py-0 !px-3 text-sm">OK</Button>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {rem === 0 && (
                                    <div className="mt-6 pt-4 border-t-4 border-gray-800 flex justify-between items-center bg-green-50 p-4 rounded-xl animate-in slide-up">
                                        <span className="text-sm font-sans uppercase text-gray-500 font-bold">Residu: 0</span>
                                        <div className="text-right">
                                            <span className="text-sm font-sans uppercase text-gray-500 block">Total</span>
                                            <span className="text-5xl font-bold text-green-700">{totalQ}</span>
                                        </div>
                                    </div>
                                )}
                                
                                <div className="mt-6 flex flex-col gap-2 pb-8">
                                     {msg && <div className="text-center text-sm font-bold text-blue-600 bg-white border border-blue-100 p-2 rounded">{msg}</div>}
                                     {rem === 0 && <Button onClick={loadLevel} variant="success" className="w-full mt-2">Nova Divisió <IconRefresh/></Button>}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MENU ---
        const App = () => {
            const [view, setView] = useState("menu");
            const [zoom, setZoom] = useState(1);

            const handleZoom = (delta) => {
                setZoom(prev => Math.min(Math.max(prev + delta, 0.7), 1.5));
            };

            const CurrentView = () => {
                if (view === "suma") return <SumaView onBack={() => setView("menu")} setView={setView} />;
                if (view === "resta") return <RestaView onBack={() => setView("menu")} setView={setView} />;
                if (view === "multi") return <MultiView onBack={() => setView("menu")} setView={setView} />;
                if (view === "divi") return <DivisioView onBack={() => setView("menu")} setView={setView} />;
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-gradient-to-br from-blue-50 via-white to-blue-50 relative overflow-y-auto custom-scroll pb-16">
                        <div className="absolute top-4 left-6 text-xs text-gray-400 font-bold uppercase tracking-widest">
                            Creat per Alfonso LM
                            <span className="block text-[10px] text-gray-300 normal-case mt-0.5">aloren26@xtec.cat</span>
                        </div>
                        <div className="absolute top-4 right-6 text-xs text-gray-400 font-bold uppercase tracking-widest text-right">
                            Escola Mossèn Cinto Verdaguer
                            <span className="block text-[10px] text-gray-300">(RUBÍ)</span>
                        </div>

                        <div className="text-center mb-8 max-w-3xl animate-in fade-in mt-12 flex-grow flex flex-col justify-center">
                            <span className="bg-blue-100 text-blue-700 px-4 py-1.5 rounded-full text-xs font-extrabold tracking-widest uppercase mb-6 inline-block shadow-sm w-fit mx-auto">Educació Primària</span>
                            <h1 className="text-4xl md:text-6xl font-extrabold text-blue-900 mb-4 tracking-tight leading-tight">
                                EL MÈTODE INNOVAMAT <br/><span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-500">PAS A PAS</span>
                            </h1>
                            <p className="text-xl text-gray-500 font-medium">Guia interactiva per a infants i famílies</p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-4xl px-4 pb-8 flex-grow-0">
                            <MenuCard title="Suma" desc="Sumem per descomposició" icon="+" color="green" onClick={() => setView("suma")} />
                            <MenuCard title="Resta" desc="Descomposició vertical" icon="−" color="blue" onClick={() => setView("resta")} />
                            <MenuCard title="Multiplicació" desc="Model geomètric (Àrea)" icon="×" color="yellow" onClick={() => setView("multi")} />
                            <MenuCard title="Divisió" desc="Caixa de quocients parcials" icon="÷" color="purple" onClick={() => setView("divi")} />
                        </div>
                        
                        {/* PEU DE PÀGINA AMB LLICÈNCIA */}
                        <div className="mt-8 mb-16 flex flex-col items-center gap-2 opacity-70">
                            <img 
                                src="https://raw.githubusercontent.com/aloren26/educaTicON/8162be79862a52c1b586f9f18168720491c622ae/cc-by-nc-sa.svg" 
                                alt="Llicència CC BY-NC-SA 4.0" 
                                style={{height: '32px'}} 
                            />
                            <span className="text-[10px] text-gray-500 font-bold tracking-wide">
                                Obra sota llicència CC BY-NC-SA 4.0
                            </span>
                        </div>
                    </div>
                );
            };

            return (
                <div className="h-screen flex flex-col relative overflow-hidden">
                    <div className="flex-1 overflow-hidden transition-transform origin-top-center relative" style={{ transform: `scale(${zoom})`, transformOrigin: 'top center', height: '100%' }}>
                        <CurrentView />
                    </div>
                    {/* ZOOM FIXED BAR */}
                    <div className="fixed bottom-0 left-0 w-full bg-white/95 backdrop-blur border-t border-gray-200 p-1 flex justify-center items-center gap-3 text-[10px] text-gray-500 z-[100] shadow-md h-8">
                        <span>Si tens problemes de visualització pots:</span>
                        <Button onClick={() => handleZoom(-0.1)} variant="zoom"><IconZoomOut/> REDUIR</Button>
                        <span className="font-bold w-6 text-center">{Math.round(zoom * 100)}%</span>
                        <Button onClick={() => handleZoom(0.1)} variant="zoom"><IconZoomIn/> AMPLIAR</Button>
                        <span>el zoom.</span>
                    </div>
                </div>
            );
        };

        const MenuCard = ({ title, desc, icon, color, onClick }) => {
            const colors = {
                green: "bg-green-500 hover:bg-green-600 shadow-green-200",
                blue: "bg-blue-500 hover:bg-blue-600 shadow-blue-200",
                yellow: "bg-yellow-500 hover:bg-yellow-600 shadow-yellow-200",
                purple: "bg-purple-500 hover:bg-purple-600 shadow-purple-200"
            };
            return (
                <button onClick={onClick} className="group bg-white p-6 rounded-2xl shadow-sm hover:shadow-xl border border-gray-100 hover:border-blue-100 transition-all duration-300 flex items-center gap-6 text-left active:scale-[0.98]">
                    <div className={`${colors[color]} w-20 h-20 rounded-2xl flex items-center justify-center text-4xl text-white font-bold shadow-lg group-hover:rotate-6 transition-transform`}>{icon}</div>
                    <div><h3 className="text-2xl font-bold text-gray-800 group-hover:text-blue-700">{title}</h3><p className="text-gray-500 font-medium mt-1">{desc}</p></div>
                    <div className="ml-auto opacity-0 group-hover:opacity-100 transition-opacity text-blue-400"><IconArrowRight /></div>
                </button>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>